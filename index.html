<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cornhole Match Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --accent:#38bdf8;
      --text:#e2e8f0;
      --muted:#94a3b8;
      --danger:#f97316;
      --ok:#22c55e;
      --warn:#fbbf24;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1f2937 0%,#020617 60%);
      color:var(--text);min-height:100vh;padding:1.5rem;
    }
    h1{text-align:center;margin-bottom:1rem}
    .container{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 1.6fr;gap:1.5rem}
    .card{
      background:rgba(2,6,23,.45);border:1px solid rgba(148,163,184,.12);
      border-radius:1rem;padding:1rem 1.25rem 1.25rem;backdrop-filter:blur(10px)
    }
    label{font-size:.75rem;text-transform:uppercase;letter-spacing:.03em;color:var(--muted);display:block;margin-bottom:.25rem}
    input,textarea,select{
      width:100%;background:rgba(15,23,42,.4);
      border:1px solid rgba(148,163,184,.2);
      border-radius:.5rem;padding:.45rem .6rem;color:var(--text)
    }
    textarea{padding:.4rem .6rem .45rem}
    .row{display:grid;grid-template-columns:repeat(2,1fr);gap:.65rem;margin-bottom:.65rem}
    .team-box{
      border:1px solid rgba(148,163,184,.2);border-radius:.75rem;
      padding:.6rem .7rem;background:rgba(15,23,42,.3);margin-bottom:.75rem
    }
    .team-title{font-weight:800;margin-bottom:.35rem}
    button{
      background:var(--accent);border:none;border-radius:.5rem;
      padding:.5rem .75rem;color:#0f172a;font-weight:800;cursor:pointer
    }
    button.secondary{background:rgba(148,163,184,.15);color:#fff;border:1px solid rgba(148,163,184,.25)}
    button.danger{background:rgba(249,115,22,.15);color:#fff;border:1px solid rgba(249,115,22,.5)}
    button:disabled{opacity:.45}
    .actions{display:flex;gap:.4rem;flex-wrap:wrap}
    table{width:100%;border-collapse:collapse;margin-top:.5rem;font-size:.78rem}
    th,td{border-bottom:1px solid rgba(148,163,184,.1);padding:.35rem}
    th{font-size:.7rem;text-transform:uppercase;color:var(--muted)}
    .score-badge{
      background:rgba(56,189,248,.15);border:1px solid rgba(56,189,248,.3);
      padding:.15rem .4rem;border-radius:.35rem;font-weight:800;font-size:.68rem
    }
    .lb-row{display:grid;grid-template-columns:1.2fr .6fr .6fr .6fr .6fr;gap:10px;padding:6px 0}
    .lb-row+.lb-row{border-top:1px solid rgba(148,163,184,.1)}
    .lb-head{color:var(--muted);font-size:.8rem}
    .summary-bar{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      background:rgba(2,6,23,.35);border:1px dashed rgba(148,163,184,.25);
      padding:8px 10px;border-radius:10px;margin-top:6px
    }
    .pill{display:inline-flex;gap:8px;border:1px solid rgba(148,163,184,.25);border-radius:999px;padding:6px 10px}
    .pill .val{font-weight:900}
    .hint{color:var(--muted);font-size:.75rem}
    @media(max-width:960px){.container{grid-template-columns:1fr}}
  </style>
</head>
<body>
<h1>Cornhole Match Tracker ðŸŸ¦ðŸŸ§</h1>

<div class="container">
  <div class="card">
    <h2>New Match</h2>

    <div class="team-box">
      <div class="team-title">Sign In</div>
      <div class="row">
        <div>
          <label>Player</label>
          <select id="playerSelect"></select>
        </div>
        <div>
          <label>PIN</label>
          <input id="pinInput" type="password" inputmode="numeric">
        </div>
      </div>
      <div class="actions">
        <button id="signInBtn">Unlock</button>
        <button id="createProfileBtn" class="secondary">Create Player Profile</button>
        <button id="managePlayersBtn" class="danger">Manage Players (Admin)</button>
      </div>
      <div id="authStatus" class="hint">Not signed in.</div>
    </div>

    <div class="row">
      <div><label>Team A Players</label><textarea id="teamAPlayers"></textarea></div>
      <div><label>Team B Players</label><textarea id="teamBPlayers"></textarea></div>
    </div>
    <div class="row">
      <div><label>Team A Score</label><input id="teamAScore" type="number"></div>
      <div><label>Team B Score</label><input id="teamBScore" type="number"></div>
    </div>
    <button id="saveMatchBtn">Save Match</button>
  </div>

  <div class="card">
    <h2>Match History</h2>
    <table>
      <thead>
        <tr><th>Date</th><th>Teams</th><th>Score</th><th>By</th></tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>

    <div class="summary-bar">
      <div class="pill"><span class="val" id="totalMatches">0</span> Matches</div>
    </div>

    <h2>Individual Leaderboard</h2>
    <div class="lb lb-head lb-row"><div>Player</div><div>W</div><div>L</div><div>G</div><div>%</div></div>
    <div id="lbIndividuals"></div>

    <h2>Team Leaderboard</h2>
    <div class="lb lb-head lb-row"><div>Team</div><div>W</div><div>L</div><div>G</div><div>%</div></div>
    <div id="lbTeams"></div>
  </div>
</div>

<script>
const API="https://solitary-moon-7578.michaelamarino16.workers.dev";
const LS_TOKEN="ct_token",LS_PLAYER="ct_player";

const api=(p,o={})=>{
  const t=localStorage.getItem(LS_TOKEN);
  return fetch(API+p,{
    ...o,
    headers:{'Content-Type':'application/json',...(t?{'Authorization':'Bearer '+t}:{})}
  }).then(r=>r.json());
};

const normalize=p=>p.trim();
const teamLabel=players=>players.map(normalize).sort().join(" + ")||"Unknown Team";

function calcLeaderboards(matches){
  const indiv=new Map(),teams=new Map();
  const ensure=(m,n)=>{const k=n.toLowerCase();if(!m.has(k))m.set(k,{name:n,wins:0,losses:0,games:0});return m.get(k)};
  for(const m of matches){
    const a=m.teamA.players||[],b=m.teamB.players||[];
    const aN=teamLabel(a),bN=teamLabel(b);
    const win=m.teamA.score>m.teamB.score?"A":m.teamB.score>m.teamA.score?"B":"T";
    a.forEach(p=>ensure(indiv,p).games++);
    b.forEach(p=>ensure(indiv,p).games++);
    ensure(teams,aN).games++;ensure(teams,bN).games++;
    if(win==="A"){a.forEach(p=>ensure(indiv,p).wins++);b.forEach(p=>ensure(indiv,p).losses++);ensure(teams,aN).wins++;ensure(teams,bN).losses++;}
    if(win==="B"){b.forEach(p=>ensure(indiv,p).wins++);a.forEach(p=>ensure(indiv,p).losses++);ensure(teams,bN).wins++;ensure(teams,aN).losses++;}
  }
  const arr=m=>[...m.values()].map(x=>({...x,winpct:x.games?Math.round(x.wins/x.games*100):0}))
    .sort((a,b)=>b.wins-a.wins||b.winpct-a.winpct||a.name.localeCompare(b.name));
  return{indivArr:arr(indiv),teamArr:arr(teams)};
}
</script>
</body>
</html>
